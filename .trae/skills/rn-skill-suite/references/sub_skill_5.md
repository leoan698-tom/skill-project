=== RN 子技能 5 ===
标题：Skill 5 - 多轮迭代优化  
版本：v1.0.0  
更新日期：2026-01-21  
导航：返回主文档 → [main_skill.md](./main_skill.md)

---
name: RN Skill 5 - 多轮迭代优化
description: 本技能用于在已有页面基础上按需补充性能、交互、加载态、无障碍与边界处理等优化点，只输出增量变更。
---

# 目的
通过多轮对话，对生成页面进行系统化优化与增强。

# 何时使用
- 已有初版页面代码需要进一步完善时。
- 需要增量地加入体验、性能与可访问性改进时。

# 输入
- 优化需求清单与新增能力项。

# 步骤
1. 针对性能、交互、加载态、无障碍、边界等分类逐项补充。
2. 仅输出需要新增或修改的片段，避免重复完整代码。
3. 标注必要类型与依赖，保持与设计系统一致。

# 提示词模板
```text
基于刚才生成的页面,进行以下优化:

【优化需求】
1. 性能优化
   - 图片轮播使用 FlatList + getItemLayout 优化
   - 长列表使用 useMemo 缓存数据
   - 避免不必要的 re-render(使用 React.memo)

2. 交互优化
   - 加入购物车按钮点击后,显示 Toast 提示
   - 规格未选择时,点击购买弹出提示
   - 图片轮播支持双击放大查看
   - 数量选择器加入震动反馈(Haptics)

3. 加载态 & 错误态
   - 页面首次加载显示 Skeleton 占位
   - 图片加载失败显示默认占位图
   - 数据请求失败显示错误提示 + 重试按钮

4. 无障碍优化
   - 所有按钮添加 accessible={true} + accessibilityLabel
   - 图片添加 accessibilityRole='image'
   - 价格添加 accessibilityLabel="当前价格 99.99 元"

5. 边界处理
   - 商品已售罄状态(按钮禁用 + 文案变为"已售罄")
   - 库存不足提示(选择数量时超出库存)
   - 未登录时收藏/购买跳转登录页

请在原有代码基础上,补充以上优化点。
只输出**需要新增或修改**的代码片段,不要重复完整代码。
```

# 输出要求
- 仅增量代码片段，包含必要的 imports 与类型补充。
- 与现有代码风格和设计系统保持一致。

# 模块化优化任务
- 将大型组件按模块化规范拆分：UI/Hook/styles/types 独立，目录清晰
- 控制单文件规模：组件≤300行，Hook≤200行；重复逻辑提取为可复用 Hook/组件
- 条件渲染安全性改造：统一采用 `!!` 或三元；数字显式比较；字符串长度检查
- Toast/Snackbar 改造：移除 Modal 实现，改用绝对定位 + zIndex/elevation

# 代码审查检查清单
- 结构：职责单一、目录清晰、导入导出明确
- 类型：Props/Hook返回值/本地状态/回调类型完整
- 样式：功能分组、有组织；集中在 styles.ts
- 逻辑：Hook 输入参数清晰、返回结构稳定；useCallback/useMemo 合理
- 条件渲染：避免 0/""/null/undefined 渲染；采用 `!!` 或三元
- 交互层级：Toast 不阻塞页面；层级与 pointerEvents 设置正确

—— 页脚 ——  
文档：sub_skill_5.md | 返回： [main_skill.md](./main_skill.md)

